language: java
jdk: 
- oraclejdk14
cache: 
  directories: 
  - $HOME/.m2
os: linux
dist: focal
arch: arm64
git:
  quiet: true
before_install:
- echo -e "machine github.com\n  login $GITHUB_TOKEN" > ~/.netrc
- git lfs pull
services:
- mysql
install: echo "skip install"
before_script:
- mysql -u root < scriptDatabase/DB.sql
- mysql -u root -e "CREATE USER '${MYSQL_USER}'@'localhost' IDENTIFIED BY '${MYSQL_PASS}';"
- mysql -u root -e "GRANT ALL ON MensaDigitale.* to '${MYSQL_USER}'@'localhost';"
- mysql -u"$MYSQL_USER" -p"$MYSQL_PASS" -e "USE MensaDigitale; SHOW tables;"
notifications: 
- slack: progettois-2020:CCvmGg5hbeqP1azu8n956S4p
script:
- mvn test -B jacoco:report
- cd $TRAVIS_BUILD_DIR
- git pull origin HEAD:main
- rm -rf docs
- mkdir docs
- mv $TRAVIS_BUILD_DIR/target/site/jacoco/index.html ./docs
- mv $TRAVIS_BUILD_DIR/target/site/jacoco/jacoco-resources ./docs
- ls ./docs
- git add docs
- git commit -am "travic-ci:updated coverage"
- git push origin HEAD:main
